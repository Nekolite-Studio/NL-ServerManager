# Agentコンポーネント修正案 検証レポート

このドキュメントは、[`remediation-plan.md`](./remediation-plan.md)で提案された`agent/`ディレクトリ関連の修正案について、その妥当性を検証した結果を記録します。

---

## 検証結果サマリー

| No. | 修正案 | 安全性 | 正確性 | 機能ファースト | 判定 |
| :-- | :--- | :--- | :--- | :--- | :--- |
| 1 | プロトコル定義の一貫性 | 高 | 高 | 適合 | **承認 (Approved)** |
| 2 | エラーハンドリングの不備 | 高 | 高 | 適合 | **承認 (Approved)** |
| 3 | データコントラクトの不備 | 中 | 高 | 適合 | **承認 (Approved)** |

---

## 1. プロトコル定義の一貫性の欠如 (マジックストリングの使用)

-   **対象:** [`agent/index.js`](../../agent/index.js:138)
-   **内容:** ハードコードされた文字列 `'get-metrics'` をプロトコル定数 `Message.GET_METRICS` に置き換える。

### 検証

-   **安全性:** **高い。** この変更は純粋なリファクタリングであり、ロジックの変更を伴いません。既存のメトリクス取得機能が破壊されるリスクは極めて低く、むしろ将来のプロトコル変更に対する追従性を高め、安全性を向上させます。
-   **正確性:** **高い。** マジックストリングを定数に置き換えることは、コードの可読性、保守性、信頼性を向上させるための技術的に正しいベストプラクティスです。
-   **機能ファースト:** **適合。** 既存の機能要件（メトリクス取得）を維持したまま、コードの品質を向上させる変更であり、原則に合致しています。

### 判定

**承認 (Approved)**

**理由:** 提案はリスクが低く、コード品質を明確に向上させるため、全面的に承認します。

---

## 2. エラーハンドリングの不備 (UIへの通知漏れ)

-   **対象:** [`agent/src/serverManager.js`](../../agent/src/serverManager.js:442)
-   **内容:** Javaバージョンが見つからずにフォールバックする際、その事実を警告として`manager`に通知する仕組みを実装する。

### 検証

-   **安全性:** **高い。** 既存のサーバー起動・停止ロジック自体には変更を加えず、通知処理を追加するだけであるため、コア機能（サーバーライフサイクル管理）への影響は軽微です。新しいメッセージタイプ `OPERATION_WARNING` の追加も、後方互換性を損なうものではありません。
-   **正確性:** **高い。** ユーザーが意図しない構成でサーバーが動作しているという重要な情報をUIにフィードバックすることは、システムの透明性を高め、ユーザーの誤解を防ぐ上で技術的に正しいアプローチです。
-   **機能ファースト:** **適合。** サーバーの起動という基本機能を、「ユーザーの意図通りに動作しているか」という観点で強化するものです。システムの信頼性とユーザー体験を向上させるため、機能要件を満たしつつ品質を向上させるという原則に合致しています。

### 判定

**承認 (Approved)**

**理由:** ユーザーに対してシステムの振る舞いを透過的にする重要な改善であり、リスクも低いため承認します。

---

## 3. データコントラクトの不備 (未実装の機能)

-   **対象:** [`agent/index.js`](../../agent/index.js:47)
-   **内容:** `getMetrics`関数を、`systeminformation`ライブラリを使用して実際のCPU、RAM、ディスク使用量を取得・返却するように実装する。

### 検証

-   **安全性:** **中程度。** 新しい外部依存 (`systeminformation`) を追加するため、ライブラリ自体の潜在的なバグやパフォーマンスへの影響を考慮する必要があります。しかし、`systeminformation`は広く利用され実績のあるライブラリであり、リスクは管理可能です。また、この機能はサーバーのコアロジックから独立しているため、万一問題が発生してもサーバー管理機能全体が停止する可能性は低いです。
-   **正確性:** **高い。** ダミーデータを返す現状から、プロトコルで定義されたデータコントラクトを正しく満たす実装に変更するものであり、技術的に完全に正しいアプローチです。提案されている実装コードも非同期処理を適切に扱っており、妥当です。
-   **機能ファースト:** **適合。** これまで未実装だった「物理サーバーの監視」という重要な機能要件を実現するものです。この実装により、アプリケーションの価値が大きく向上します。

### 判定

**承認 (Approved)**

**理由:** 新機能の実装によってアプリケーションの価値が大幅に向上します。外部ライブラリ導入のリスクは存在するものの、そのメリットはリスクを大きく上回ると判断します。