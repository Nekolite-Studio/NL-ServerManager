<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Server Modal Mockup</title>
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons (CDN) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gray: {
                            750: '#2d3748',
                            850: '#1a202c', 
                            900: '#111827',
                            950: '#0d1117', 
                        },
                        blue: {
                            650: '#2b6cb0', // Custom accent
                        }
                    },
                    animation: {
                        'spin-slow': 'spin 3s linear infinite',
                    }
                }
            }
        }
    </script>
    <style>
        /* „Ç´„Çπ„Çø„É†„Çπ„ÇØ„É≠„Éº„É´„Éê„Éº */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; 
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; 
        }
        
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }

        /* „É¢„Éº„ÉÄ„É´„ÅÆË°®Á§∫„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        .modal-enter {
            opacity: 0;
            transform: scale(0.95);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 0.2s ease-out, transform 0.2s ease-out;
        }
        .modal-exit {
            opacity: 1;
            transform: scale(1);
        }
        .modal-exit-active {
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.2s ease-in, transform 0.2s ease-in;
        }

        /* „Éì„É´„Éâ„É≠„Éº„Éá„Ç£„É≥„Ç∞ÊôÇ„ÅÆ„Çπ„Çø„Ç§„É´ */
        .select-loading {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #1f2937; /* gray-800 */
            background-image: linear-gradient(45deg, rgba(255,255,255,0.05) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.05) 50%, rgba(255,255,255,0.05) 75%, transparent 75%, transparent);
            background-size: 20px 20px;
            animation: stripe-move 1s linear infinite;
        }
        @keyframes stripe-move {
            0% { background-position: 0 0; }
            100% { background-position: 20px 20px; }
        }
    </style>
</head>
<body class="bg-gray-900 text-slate-200 h-screen overflow-hidden relative">

    <!-- === 1. „É°„Ç§„É≥„Ç¢„Éó„É™ÁîªÈù¢ÔºàËÉåÊôØÔºâ === -->
    <div id="mainApp" class="absolute inset-0 z-0 flex flex-col">
        <!-- „Çµ„Ç§„Éâ„Éê„Éº -->
        <div class="flex flex-1">
            <nav class="w-64 bg-gray-950 border-r border-gray-800 p-4 flex flex-col gap-4">
                <div class="h-8 bg-gray-800 rounded w-3/4 animate-pulse"></div>
                <div class="space-y-2 mt-4">
                    <div class="h-10 bg-gray-800 rounded w-full"></div>
                    <div class="h-10 bg-gray-800/50 rounded w-full"></div>
                    <div class="h-10 bg-gray-800/50 rounded w-full"></div>
                </div>
            </nav>
            <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <main class="flex-1 p-10 flex flex-col items-center justify-center bg-gray-900 gap-6">
                <div class="text-center space-y-2">
                    <h1 class="text-3xl font-bold text-gray-700">Server Manager Dashboard</h1>
                    <p class="text-gray-500">No servers found. Create one to get started.</p>
                </div>
                
                <!-- „É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè„Éà„É™„Ç¨„Éº„Éú„Çø„É≥ -->
                <button onclick="toggleModal(true)" class="px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-lg shadow-lg font-bold flex items-center gap-2 transition-transform active:scale-95">
                    <i data-lucide="plus" class="w-5 h-5"></i>
                    Êñ∞Ë¶è„Çµ„Éº„Éê„Éº„Çí‰ΩúÊàê
                </button>
            </main>
        </div>
    </div>

    <!-- === 2. „É¢„Éº„ÉÄ„É´„Ç™„Éº„Éê„Éº„É¨„Ç§ === -->
    <div id="modalOverlay" class="fixed inset-0 z-40 hidden">
        <!-- ËÉåÊôØ„ÅÆÈªíÈÄèÈÅé -->
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm transition-opacity opacity-0" id="modalBackdrop"></div>

        <!-- „É¢„Éº„ÉÄ„É´ÈÖçÁΩÆ„Ç≥„É≥„ÉÜ„Éä -->
        <div class="absolute inset-0 flex items-center justify-center p-4">
            
            <!-- „É¢„Éº„ÉÄ„É´Êú¨‰Ωì -->
            <div id="modalContent" class="relative w-full max-w-4xl bg-gray-900 shadow-2xl border border-gray-700 flex flex-col md:flex-row h-[680px] rounded-xl opacity-0 transform scale-95 transition-all duration-200">
                
                <!-- Â∑¶„Ç´„É©„É†: Âü∫Êú¨Ë®≠ÂÆö -->
                <div class="w-full md:w-5/12 bg-gray-950 p-6 flex flex-col border-b md:border-b-0 md:border-r border-gray-700 rounded-t-xl md:rounded-tr-none md:rounded-l-xl z-20">
                    <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                        <i data-lucide="plus-circle" class="w-5 h-5 text-blue-500"></i>
                        Êñ∞Ë¶è„Çµ„Éº„Éê„Éº‰ΩúÊàê
                    </h2>

                    <div class="space-y-6 flex-1">
                        
                        <!-- 1. „Çµ„Éº„Éê„ÉºÂêç -->
                        <div class="group">
                            <label class="block text-xs font-semibold text-gray-400 mb-2 uppercase tracking-wider group-focus-within:text-blue-400 transition-colors">
                                „Çµ„Éº„Éê„ÉºÂêç
                            </label>
                            <div class="relative">
                                <i data-lucide="tag" class="absolute left-3 top-3 w-5 h-5 text-gray-500"></i>
                                <input type="text" id="serverNameInput" placeholder="My Survival World" 
                                    class="w-full bg-gray-800 text-white pl-10 pr-4 py-3 rounded-lg border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all placeholder-gray-600"
                                    autocomplete="off">
                            </div>
                        </div>

                        <!-- 2. „Éõ„Çπ„Éà„Éû„Ç∑„É≥ -->
                        <div>
                            <label class="block text-xs font-semibold text-gray-400 mb-2 uppercase tracking-wider">
                                „Éõ„Çπ„Éà„Éû„Ç∑„É≥
                            </label>
                            <div class="relative">
                                <i data-lucide="server" class="absolute left-3 top-3 w-5 h-5 text-gray-500"></i>
                                <select class="w-full bg-gray-800 text-white pl-10 pr-8 py-3 rounded-lg border border-gray-700 focus:border-blue-500 outline-none appearance-none cursor-pointer hover:bg-gray-750 transition-colors">
                                    <option>Local Agent (127.0.0.1)</option>
                                    <option>Remote VPS (192.168.1.50)</option>
                                </select>
                                <i data-lucide="chevron-down" class="absolute right-3 top-3.5 w-4 h-4 text-gray-500 pointer-events-none"></i>
                            </div>
                        </div>

                        <!-- 3. „Çµ„Éº„Éê„Éº„Çø„Ç§„Éó -->
                        <div class="relative z-50">
                            <label class="block text-xs font-semibold text-gray-400 mb-2 uppercase tracking-wider">
                                „Çµ„Éº„Éê„Éº„Çø„Ç§„Éó
                            </label>
                            
                            <!-- „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥ „Éà„É™„Ç¨„Éº -->
                            <button id="typeSelectBtn" class="w-full bg-gray-800 hover:bg-gray-750 border border-gray-600 hover:border-gray-500 text-left rounded-lg p-3 flex items-center justify-between group transition-all duration-200">
                                <div class="flex items-center gap-3">
                                    <div id="selectedTypeIcon" class="w-10 h-10 rounded bg-gray-700 flex items-center justify-center text-xl transition-colors group-hover:bg-gray-600">
                                        üßä
                                    </div>
                                    <div>
                                        <div id="selectedTypeName" class="font-bold text-white text-lg leading-tight">Vanilla</div>
                                        <div id="selectedTypeDesc" class="text-xs text-gray-400">Minecraft ÂÖ¨Âºè„Çµ„Éº„Éê„Éº</div>
                                    </div>
                                </div>
                                <i data-lucide="chevrons-up-down" class="w-5 h-5 text-gray-500"></i>
                            </button>

                            <!-- „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥ „É°„Éã„É•„Éº -->
                            <div id="typeDropdownMenu" class="hidden absolute top-full left-0 w-full mt-2 bg-gray-800 border border-gray-600 rounded-lg shadow-[0_10px_40px_-10px_rgba(0,0,0,0.7)] max-h-[300px] overflow-y-auto z-50 divide-y divide-gray-700">
                                <!-- JS„ÅßÊ≥®ÂÖ• -->
                            </div>
                        </div>

                    </div>
                    
                    <!-- Ê≥®ÊÑèÊõ∏„Åç -->
                    <div class="mt-auto pt-6 text-xs text-yellow-500/80 flex items-start gap-2">
                        <i data-lucide="alert-triangle" class="w-4 h-4 mt-0.5 shrink-0"></i>
                        <span>„Çµ„Éº„Éê„ÉºÂêç‰ª•Â§ñ„ÅØ‰ΩúÊàêÂæå„Å´Â§âÊõ¥„Åß„Åç„Åæ„Åõ„Çì„ÄÇÊÖéÈáç„Å´ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</span>
                    </div>
                </div>

                <!-- Âè≥„Ç´„É©„É†: Ë©≥Á¥∞Ë®≠ÂÆö (ÊßãÈÄ†Â§âÊõ¥) -->
                <div class="w-full md:w-7/12 bg-gray-900 p-8 flex flex-col relative rounded-b-xl md:rounded-bl-none md:rounded-r-xl z-10 overflow-y-auto">
                    
                    <div class="flex-1 space-y-8">
                        
                        <!-- BLOCK 1: Minecraft Version Base -->
                        <div class="space-y-4">
                            <!-- Header & Filter -->
                            <div class="flex justify-between items-end border-b border-gray-800 pb-2">
                                <label class="text-xs font-bold text-gray-400 uppercase tracking-wider flex items-center gap-2">
                                    <i data-lucide="box" class="w-3 h-3"></i>
                                    Minecraft Base
                                </label>
                                
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <span class="text-xs text-gray-400 group-hover:text-gray-300 transition-colors">Show Snapshots</span>
                                    <div class="relative">
                                        <input type="checkbox" id="snapshotToggle" class="sr-only peer">
                                        <div class="w-8 h-4 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-blue-600"></div>
                                    </div>
                                </label>
                            </div>

                            <!-- Selector Row -->
                            <div class="flex gap-2">
                                <div class="relative flex-1">
                                    <select id="mcVersionSelect" class="w-full bg-gray-800 text-white pl-4 pr-8 py-2.5 rounded-lg border border-gray-700 focus:border-blue-500 outline-none appearance-none cursor-pointer text-sm">
                                        <!-- JS„ÅßÊ≥®ÂÖ• -->
                                    </select>
                                    <i data-lucide="chevron-down" class="absolute right-3 top-3 w-4 h-4 text-gray-500 pointer-events-none"></i>
                                </div>
                                
                                <!-- „Éû„Éã„Éï„Çß„Çπ„ÉàÊõ¥Êñ∞„Éú„Çø„É≥ -->
                                <button id="refreshManifestBtn" class="px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-gray-400 hover:text-white transition-colors flex items-center justify-center group" title="Update Version Manifest">
                                    <i data-lucide="refresh-cw" class="w-4 h-4 group-hover:rotate-180 transition-transform duration-500"></i>
                                </button>
                            </div>

                            <!-- Meta Info -->
                            <div class="flex justify-between text-[11px] text-gray-500 px-1">
                                <span id="manifestUpdatedText">Manifest updated: 10 mins ago</span>
                                <span id="versionCountLabel">Loading...</span>
                            </div>
                        </div>

                        <!-- BLOCK 2: Server Executable (Build) -->
                        <div id="buildBlock" class="space-y-4 pt-2 border-t border-gray-800/50">
                            <!-- Header -->
                            <div class="flex justify-between items-end pb-1">
                                <label class="text-xs font-bold text-gray-400 uppercase tracking-wider flex items-center gap-2" id="buildLabel">
                                    <i data-lucide="cpu" class="w-3 h-3"></i>
                                    Server Executable
                                </label>
                                <!-- Status Badge -->
                                <span id="buildStatusBadge" class="text-[10px] px-2 py-0.5 rounded-full bg-green-900/30 text-green-400 border border-green-800/50">
                                    Ready
                                </span>
                            </div>

                            <!-- Selector Row -->
                            <div class="flex gap-2">
                                <div class="relative flex-1">
                                    <select id="buildSelect" class="w-full bg-gray-800 text-white pl-4 pr-8 py-2.5 rounded-lg border border-gray-700 focus:border-blue-500 outline-none appearance-none cursor-pointer text-sm">
                                        <!-- JS„ÅßÊ≥®ÂÖ• -->
                                    </select>
                                    <i id="buildIcon" data-lucide="package" class="absolute right-10 top-3 w-4 h-4 text-gray-500 pointer-events-none"></i>
                                    <i data-lucide="chevron-down" class="absolute right-3 top-3 w-4 h-4 text-gray-500 pointer-events-none"></i>
                                </div>

                                <!-- „Éì„É´„ÉâÂçò‰ΩìÊõ¥Êñ∞„Éú„Çø„É≥ -->
                                <button id="refreshBuildBtn" class="px-3 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-lg text-gray-400 hover:text-white transition-colors flex items-center justify-center group" title="Refresh Builds for this Version">
                                    <i data-lucide="rotate-cw" class="w-4 h-4 group-hover:rotate-180 transition-transform duration-500"></i>
                                </button>
                            </div>

                             <!-- Meta Info -->
                             <div class="flex justify-between text-[11px] text-gray-500 px-1">
                                <span id="buildUpdatedText">Cached: Just now</span>
                                <span class="text-blue-400" id="javaVersionDisplay">Java 21 Required</span>
                            </div>
                        </div>

                    </div>

                    <!-- „Éï„ÉÉ„Çø„Éº„Ç¢„ÇØ„Ç∑„Éß„É≥ -->
                    <div class="mt-auto pt-6 border-t border-gray-800 flex justify-end gap-3">
                        <button onclick="toggleModal(false)" id="cancelBtn" class="px-5 py-2.5 rounded-lg text-gray-400 hover:text-white hover:bg-gray-800 transition-colors font-medium text-sm">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                        
                        <button id="createBtn" onclick="handleCreate()" class="px-8 py-2.5 bg-blue-600 hover:bg-blue-500 disabled:bg-blue-800 disabled:cursor-not-allowed text-white rounded-lg shadow-lg shadow-blue-900/30 transition-all font-bold text-sm flex items-center gap-2 transform active:scale-95 disabled:scale-100 min-w-[120px] justify-center">
                            <span id="createBtnText" class="flex items-center gap-2">
                                <i data-lucide="check" class="w-4 h-4"></i>
                                ‰ΩúÊàê
                            </span>
                            <span id="createSpinner" class="hidden">
                                <i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>
                                ÈÄÅ‰ø°‰∏≠...
                            </span>
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- 1. „Éá„Éº„ÇøÂÆöÁæ© (Mock Data) ---
        
        const serverTypes = [
            { category: "Official", items: [{ id: "vanilla", name: "Vanilla", icon: "üßä", desc: "Minecraft ÂÖ¨Âºè„Çµ„Éº„Éê„Éº" }] },
            { category: "Mod Loaders", items: [
                { id: "forge", name: "Forge", icon: "‚öíÔ∏è", desc: "ÂÆöÁï™„ÅÆÂ§ßË¶èÊ®°Mod„É≠„Éº„ÉÄ„Éº" },
                { id: "neoforge", name: "NeoForge", icon: "ü¶ä", desc: "Forge„Åã„ÇâÊ¥æÁîü„Åó„ÅüÊñ∞Ê®ôÊ∫ñ" },
                { id: "fabric", name: "Fabric", icon: "üßµ", desc: "ËªΩÈáè„Åã„Å§È´òÈÄü„Å™„É≠„Éº„ÉÄ„Éº" },
            ]},
            { category: "Plugins", items: [
                { id: "paper", name: "Paper", icon: "üìÑ", desc: "È´òÈÄü„ÉªËªΩÈáè„Éó„É©„Ç∞„Ç§„É≥„Çµ„Éº„Éê„Éº" },
                { id: "spigot", name: "Spigot", icon: "‚ö°", desc: "„Éó„É©„Ç∞„Ç§„É≥„Çµ„Éº„Éê„Éº„ÅÆÂÖÉÁ•ñ" },
            ]},
            { category: "Hybrid", items: [{ id: "mohist", name: "Mohist", icon: "üß¨", desc: "Forge Mods + Paper Plugins" }] }
        ];

        const mcVersions = {
            all: ["1.20.4", "1.20.3", "1.20.2", "1.20.1", "1.19.4", "1.18.2", "1.16.5", "1.12.2"],
            snapshots: ["24w09a (Snap)", "24w07a (Snap)", "1.20.5-pre1", "1.20.4"], 
            limited: ["1.20.2", "1.20.1", "1.16.5", "1.12.2"] 
        };

        const builds = {
            "forge-1.20.1": ["47.2.19 (Latest)", "47.2.0 (Recommended)", "47.1.0"],
            "paper-1.20.4": ["#430 (Latest)", "#428", "#410"],
            "default": ["Latest Build", "Stable Build"]
        };

        let state = {
            selectedType: serverTypes[0].items[0], 
            showSnapshots: false,
            selectedVersion: "1.20.4"
        };

        const els = {
            modalOverlay: document.getElementById('modalOverlay'),
            modalBackdrop: document.getElementById('modalBackdrop'),
            modalContent: document.getElementById('modalContent'),
            createBtn: document.getElementById('createBtn'),
            createBtnText: document.getElementById('createBtnText'),
            createSpinner: document.getElementById('createSpinner'),
            cancelBtn: document.getElementById('cancelBtn'),

            typeBtn: document.getElementById('typeSelectBtn'),
            typeMenu: document.getElementById('typeDropdownMenu'),
            selectedIcon: document.getElementById('selectedTypeIcon'),
            selectedName: document.getElementById('selectedTypeName'),
            selectedDesc: document.getElementById('selectedTypeDesc'),
            
            snapshotToggle: document.getElementById('snapshotToggle'),
            mcVersionSelect: document.getElementById('mcVersionSelect'),
            versionCount: document.getElementById('versionCountLabel'),
            manifestUpdated: document.getElementById('manifestUpdatedText'),
            refreshManifestBtn: document.getElementById('refreshManifestBtn'),
            
            buildBlock: document.getElementById('buildBlock'),
            buildLabel: document.getElementById('buildLabel'),
            buildSelect: document.getElementById('buildSelect'),
            buildIcon: document.getElementById('buildIcon'),
            buildStatus: document.getElementById('buildStatusBadge'),
            buildUpdated: document.getElementById('buildUpdatedText'),
            refreshBuildBtn: document.getElementById('refreshBuildBtn'),
            
            javaVer: document.getElementById('javaVersionDisplay')
        };

        // --- 2. „É¢„Éº„ÉÄ„É´ÈñãÈñâ„É≠„Ç∏„ÉÉ„ÇØ ---

        window.toggleModal = (show) => {
            if (show) {
                els.modalOverlay.classList.remove('hidden');
                setTimeout(() => {
                    els.modalBackdrop.classList.remove('opacity-0');
                    els.modalContent.classList.remove('opacity-0', 'scale-95');
                }, 10);
                resetCreateButton();
            } else {
                els.modalBackdrop.classList.add('opacity-0');
                els.modalContent.classList.add('opacity-0', 'scale-95');
                setTimeout(() => {
                    els.modalOverlay.classList.add('hidden');
                }, 200);
            }
        };

        els.modalOverlay.addEventListener('click', (e) => {
            if (e.target === els.modalOverlay || e.target === document.querySelector('#modalOverlay > div.p-4')) {
                toggleModal(false);
            }
        });


        // --- 3. Êõ¥Êñ∞„É≠„Ç∏„ÉÉ„ÇØ („Ç®„É©„Éº‰øÆÊ≠£Ê∏à„Åø) ---
        
        // ÂÖ±ÈÄö: ÂõûËª¢„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Éò„É´„Éë„Éº
        function animateButton(btnElement, duration = 1000) {
            // querySelector('svg') „ÅßÁ¢∫ÂÆü„Å´ÂèñÂæó
            const icon = btnElement.querySelector('svg') || btnElement.querySelector('i');
            if(icon && !icon.classList.contains('animate-spin')) {
                icon.classList.add('animate-spin');
                setTimeout(() => icon.classList.remove('animate-spin'), duration);
            }
        }

        // „Éû„Éã„Éï„Çß„Çπ„ÉàÊõ¥Êñ∞ (MC„Éê„Éº„Ç∏„Éß„É≥‰∏ÄË¶ß)
        els.refreshManifestBtn.addEventListener('click', () => {
            animateButton(els.refreshManifestBtn);
            els.manifestUpdated.textContent = 'Updating manifest...';
            els.manifestUpdated.className = 'text-blue-400 font-medium';
            
            setTimeout(() => {
                const now = new Date();
                els.manifestUpdated.textContent = `Manifest updated: ${now.toLocaleTimeString()}`;
                els.manifestUpdated.className = 'text-green-400 font-medium';
                setTimeout(() => els.manifestUpdated.className = 'text-gray-500', 2000);
                console.log("Manifest refreshed");
            }, 1000);
        });

        // „Éì„É´„ÉâÊõ¥Êñ∞ (Loader„Éì„É´„Éâ‰∏ÄË¶ß)
        els.refreshBuildBtn.addEventListener('click', () => {
            if(state.selectedType.id === 'vanilla') return;
            
            animateButton(els.refreshBuildBtn);
            fetchBuilds(state.selectedVersion, true); // true = force refresh
        });


        // --- 4. „Éì„É´„ÉâÂèñÂæó„É≠„Ç∏„ÉÉ„ÇØ (LoadingÊºîÂá∫) ---

        function fetchBuilds(version, isRefresh = false) {
            if (state.selectedType.id === 'vanilla') return;

            // UI„ÇíLoadingÁä∂ÊÖã„Å´„Åô„Çã
            els.buildSelect.disabled = true;
            els.buildSelect.classList.add('select-loading', 'text-gray-400');
            els.buildSelect.innerHTML = '<option>Fetching builds from API...</option>';
            els.buildStatus.textContent = 'Fetching...';
            els.buildStatus.className = 'text-[10px] px-2 py-0.5 rounded-full bg-blue-900/30 text-blue-400 border border-blue-800/50 animate-pulse';
            
            if(isRefresh) els.buildUpdated.textContent = 'Refreshing cache...';

            // Êì¨‰ººAPIÈÅÖÂª∂ (0.5s ~ 1.5s)
            const delay = 600 + Math.random() * 800;

            setTimeout(() => {
                // „Éá„Éº„ÇøË®≠ÂÆö
                els.buildSelect.innerHTML = '';
                const key = `${state.selectedType.id}-${version}`;
                const buildList = builds[key] || builds['default'];
                
                buildList.forEach(b => {
                    const opt = document.createElement('option');
                    opt.value = b;
                    opt.textContent = b;
                    els.buildSelect.appendChild(opt);
                });

                // UIÂæ©Â∏∞
                els.buildSelect.disabled = false;
                els.buildSelect.classList.remove('select-loading', 'text-gray-400');
                
                els.buildStatus.textContent = 'Ready';
                els.buildStatus.className = 'text-[10px] px-2 py-0.5 rounded-full bg-green-900/30 text-green-400 border border-green-800/50';

                const now = new Date();
                els.buildUpdated.textContent = `Cached: ${now.toLocaleTimeString()}`;
                
            }, delay);
        }


        // --- 5. ‰ΩúÊàê„Éú„Çø„É≥„ÅÆ„É≠„Ç∏„ÉÉ„ÇØ ---

        window.handleCreate = () => {
            els.createBtn.disabled = true;
            els.createBtnText.classList.add('hidden');
            els.createSpinner.classList.remove('hidden');
            els.createSpinner.classList.add('flex', 'items-center', 'gap-2');
            els.cancelBtn.disabled = true;
            els.cancelBtn.classList.add('opacity-50', 'cursor-not-allowed');

            setTimeout(() => {
                toggleModal(false);
            }, 2000);
        };

        function resetCreateButton() {
            els.createBtn.disabled = false;
            els.createBtnText.classList.remove('hidden');
            els.createSpinner.classList.add('hidden');
            els.createSpinner.classList.remove('flex');
            els.cancelBtn.disabled = false;
            els.cancelBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }


        // --- 6. „Éï„Ç©„Éº„É†Âü∫Êú¨„É≠„Ç∏„ÉÉ„ÇØ ---

        lucide.createIcons();

        function renderTypeDropdown() {
            let html = '';
            serverTypes.forEach(cat => {
                html += `<div class="p-2">`;
                html += `<div class="text-xs font-bold text-gray-500 px-2 py-1 uppercase tracking-wider">${cat.category}</div>`;
                cat.items.forEach(type => {
                    html += `
                        <button onclick="selectType('${type.id}')" class="w-full flex items-center gap-3 p-2 rounded hover:bg-gray-700 transition-colors text-left group">
                            <div class="w-8 h-8 rounded bg-gray-700 flex items-center justify-center text-lg shadow-inner group-hover:bg-gray-600 transition-colors">
                                ${type.icon}
                            </div>
                            <div>
                                <div class="text-sm font-bold text-gray-200">${type.name}</div>
                                <div class="text-[10px] text-gray-500 group-hover:text-gray-400">${type.desc}</div>
                            </div>
                        </button>
                    `;
                });
                html += `</div>`;
            });
            els.typeMenu.innerHTML = html;
        }

        window.selectType = (typeId) => {
            let found = null;
            serverTypes.forEach(c => {
                const item = c.items.find(i => i.id === typeId);
                if(item) found = item;
            });

            if (!found) return;
            state.selectedType = found;

            els.selectedIcon.textContent = found.icon;
            els.selectedName.textContent = found.name;
            els.selectedDesc.textContent = found.desc;
            
            // Vanilla„ÅÆÂ†¥Âêà„ÄÅ„Éì„É´„ÉâÊ¨Ñ„ÇíÈö†„Åô„ÅÆ„Åß„ÅØ„Å™„ÅèDisabledÂåñ+ÊÉÖÂ†±Ë°®Á§∫„Å´„Åô„ÇãÊñπ„Åå„ÄÅÊßãÈÄ†„ÅåÂ¥©„Çå„Å™„ÅÑ
            if (found.id === 'vanilla') {
                els.buildBlock.classList.add('opacity-50', 'pointer-events-none');
                els.buildStatus.textContent = 'Managed by Mojang';
                els.buildStatus.className = 'text-[10px] px-2 py-0.5 rounded-full bg-gray-700 text-gray-400';
            } else {
                els.buildBlock.classList.remove('opacity-50', 'pointer-events-none');
                els.buildLabel.innerHTML = `<i data-lucide="package" class="w-3 h-3 mr-2"></i> ${found.name} Build`;
                lucide.createIcons(); // Êñ∞„Åó„ÅÑHTMLÂÖ•„Çå„Åü„ÅÆ„ÅßÂÜçÂÆüË°å
                
                // „Çø„Ç§„Éó„ÅåÂ§â„Çè„Å£„Åü„ÅÆ„Åß„Éì„É´„ÉâÂèñÂæó
                fetchBuilds(state.selectedVersion);
            }

            toggleTypeDropdown(false);
            updateVersionList();
        };

        function toggleTypeDropdown(forceState = null) {
            const isHidden = els.typeMenu.classList.contains('hidden');
            const shouldShow = forceState !== null ? forceState : isHidden;

            if (shouldShow) {
                els.typeMenu.classList.remove('hidden');
                els.typeBtn.classList.add('ring-2', 'ring-blue-500', 'border-transparent');
            } else {
                els.typeMenu.classList.add('hidden');
                els.typeBtn.classList.remove('ring-2', 'ring-blue-500', 'border-transparent');
            }
        }

        function updateVersionList() {
            els.mcVersionSelect.innerHTML = '';
            
            let list = [];
            if (state.showSnapshots) {
                list = mcVersions.snapshots;
            } else if (['mohist', 'quilt'].includes(state.selectedType.id)) {
                list = mcVersions.limited;
            } else {
                list = mcVersions.all;
            }

            list.forEach(ver => {
                const opt = document.createElement('option');
                opt.value = ver;
                opt.textContent = ver;
                els.mcVersionSelect.appendChild(opt);
            });

            els.versionCount.textContent = `${list.length} versions`;
            state.selectedVersion = list[0];
            
            updateJavaVersion();
            // MC„Éê„Éº„Ç∏„Éß„É≥Â§âÊõ¥ÊôÇ„ÅØ„ÄÅ„Éì„É´„Éâ„ÇÇÂÜçÂèñÂæó
            if(state.selectedType.id !== 'vanilla') {
                fetchBuilds(list[0]);
            }
        }

        function updateJavaVersion() {
            const v = state.selectedVersion;
            let java = "Java 8";
            if (v.includes("1.20") || v.includes("1.19") || v.includes("1.18")) {
                java = "Java 17";
            } else if (v.includes("1.21") || v.includes("24w")) {
                java = "Java 21";
            } else if (v.includes("1.17") || v.includes("1.16.5")) {
                java = "Java 16/11";
            }
            els.javaVer.textContent = `${java} Required`;
        }

        // Event Listeners
        els.typeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleTypeDropdown();
        });

        document.addEventListener('click', (e) => {
            if (!els.typeBtn.contains(e.target) && !els.typeMenu.contains(e.target)) {
                toggleTypeDropdown(false);
            }
        });

        els.snapshotToggle.addEventListener('change', (e) => {
            state.showSnapshots = e.target.checked;
            updateVersionList();
        });

        els.mcVersionSelect.addEventListener('change', (e) => {
            state.selectedVersion = e.target.value;
            updateJavaVersion();
            // MC„Éê„Éº„Ç∏„Éß„É≥„ÅåÂ§â„Çè„Å£„Åü„Çâ„ÄÅ„Åù„Çå„Å´ÂØæÂøú„Åô„Çã„Éì„É´„Éâ„ÇíÂèñ„Çä„Å´Ë°å„Åè
            fetchBuilds(e.target.value);
        });

        // Init
        renderTypeDropdown();
        updateVersionList();

    </script>
</body>
</html>